let UserModel,APIError;_ab8‍.x([["default",()=>_ab8‍.o]]);_ab8‍.w("./user.model.js",[["default",["UserModel"],function(v){UserModel=v}]]);_ab8‍.w("./APIError.js",[["default",["APIError"],function(v){APIError=v}]]);


class UserDAL {
  constructor() {
    if (!!UserDAL.instance) {
      return UserDAL.instance;
    }

    UserDAL.instance = this;
    return this;
  }

  async getOne(id) {
    const user = await UserModel.findByPk(id);

    if (!user)
      throw new APIError(
        {
          name: 'user_not_found',
          httpCode: 404,
          details: [`User with id ${id} cannot be found`],
        },
        true
      );
    return user.toResponse();
  }

  async getAll() {
    const users = await UserModel.findAll();

    _ab8‍.g.console.log(users[0].id)
    return users.map(user => user.toResponse());
  }

  async create(properties) {
    const user = await UserModel.create({ ...properties });

    return user.toResponse();
  }

  async update(id, properties) {
    const user = await UserModel.findByPk(id);

    if (!user)
      throw new APIError(
        {
          name: 'user_not_found',
          httpCode: 404,
          details: [`User with id ${id} cannot be found and therefore wasn't updated`],
        },
        true
      );

    Object.entries(properties).forEach(([key, value]) => {
      user[key] = value;
    });

    await user.save();
  }

  async delete(id) {
    const user = await UserModel.findByPk(id);

    if (!user)
      throw new APIError(
        {
          name: 'user_not_found',
          httpCode: 404,
          details: [`User with id ${id} cannot be found and therefore wasn't deleted`],
        },
        true
      );
    await user.destroy();
  }
}

_ab8‍.d(UserDAL);
